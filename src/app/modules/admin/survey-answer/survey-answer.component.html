<div class="flex flex-col w-full bg-white">
	<page-header
		class="w-full"
		pageTitle="Answer a Survey"
		subtitle="Please fill up the survey form for us to predict your academic performance results. It may help other students to predict theirs."
		icon="mat_outline:drive_file_rename_outline"
	></page-header>

	<div
		@slideInBottom
		*ngIf="showSubmitSurvey"
		[formGroup]="form"
		class="grid grid-cols-5 items-center gap-10 p-10"
	>
		<mat-form-field class="w-full">
			<mat-label>Year Level</mat-label>

			<mat-select formControlName="year_level">
				<mat-option
					[value]="item"
					*ngFor="let item of YEAR_LEVELS; trackBy: identity"
					>{{ item }}</mat-option
				>
			</mat-select>
		</mat-form-field>

		<mat-form-field class="w-full">
			<mat-label>Last Semester Enrolled</mat-label>

			<mat-select formControlName="semester">
				<mat-option
					[value]="item"
					*ngFor="let item of SEMESTERS; trackBy: identity"
					>{{ item }}</mat-option
				>
			</mat-select>
		</mat-form-field>

		<div>
			<button
				[ngClass]="{
					'bg-blue-800': form.valid && !form.disabled,
					'bg-gray-500': form.disabled || !form.valid
				}"
				class="fuse-mat-button-large w-full mt-3 flex text-white py-3 font-bold hover:bg-blue-900 items-center justify-center"
				[disabled]="form.disabled || !form.valid"
				(click)="save()"
			>
				<span *ngIf="!form.disabled">Submit Survey </span>

				<mat-progress-spinner
					*ngIf="form.disabled"
					[diameter]="24"
					[mode]="'indeterminate'"
				></mat-progress-spinner>
			</button>
		</div>
	</div>

	<div *ngIf="currentForm && !showSubmitSurvey">
		<div
			@slideInBottom
			[ngClass]="{ hidden: currentForm.id !== form.id }"
			*ngFor="let form of forms; trackBy: identity; let formIndex = index"
			class="grid grid-cols-2 items-center p-10 gap-y-0"
			style="min-height: 79vh"
		>
			<div class="col-span-2 text-4xl font-extrabold">{{ form.name }}</div>

			<div class="col-span-1 md:-mt-40">
				<!-- animateJs
					animation="animate__slideInLeft" -->
				<div
					@slideInLeft
					[class.hidden]="currentQuestion.id !== question.id"
					class="bg-white shadow-2xl shadow-blue-50 border border-gray-200 rounded-md p-5 py-10 flex flex-col animate__faster"
					*ngFor="
						let question of form.questions;
						trackBy: identity;
						let questionIndex = index
					"
				>
					<div class="text-3xl font-bold flex items-center">
						Question ({{ questionIndex + 1 }}) out of
						{{ form.questions.length }}
					</div>
					<div class="text-lg flex items-center text-gray-400">
						<mat-icon class="mr-2 text-gray-400" svgIcon="info"></mat-icon>
						{{ question.question }}
					</div>

					<div class="grid grid-cols-3 gap-10 mt-10">
						<button
							*ngFor="
								let rating of ratings;
								trackBy: identity;
								let ratingIndex = index
							"
							class="border text-sm p-5 hover:bg-yellow-500 hover:text-white hover:border-transparent"
						>
							{{ rating }}
						</button>
					</div>

					<div class="flex">
						<button
							*ngIf="questionIndex !== 0"
							(click)="currentQuestion = form.questions[questionIndex - 1]"
							class="mt-10 ml-auto font-extrabold px-10 py-3 flex items-center hover:bg-gray-50 border"
						>
							<mat-icon
								class="mr-2 text-black"
								svgIcon="heroicons_solid:arrow-left"
							></mat-icon>
							Back
						</button>

						<button
							(click)="onNext(formIndex, form)"
							[ngClass]="{ 'ml-auto': questionIndex === 0 }"
							class="mt-10 font-extrabold bg-blue-800 text-white px-10 py-3 flex items-center hover:bg-blue-900"
						>
							Next

							<mat-icon
								class="ml-2 text-white"
								svgIcon="heroicons_solid:arrow-right"
							></mat-icon>
						</button>
					</div>
				</div>
			</div>

			<div>
				<img
					class="w-full object-contain"
					style="max-height: 50vh"
					src="/assets/app/survey-form/grit.svg"
					alt="grit image"
				/>
			</div>
		</div>
	</div>
</div>
